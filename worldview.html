<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"><meta http-equiv="refresh" content="300">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Gordon â€” Worldview</title>
  <link rel="icon" href="assets/gordon-logo.svg">
  <link rel="stylesheet" href="assets/style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
</head>
<body>
  <nav class="nav">
    <a href="index.html" class="nav-brand"><img src="assets/gordon-logo.svg" alt="G">gordon.money</a>
    <div class="nav-links">
      <a href="index.html">Overview</a>
      <a href="strategies.html">Strategies</a>
      <a href="predictions.html">Predictions</a>
      <a href="signals.html">Signals</a>
      <a href="worldview.html" class="active">Worldview</a>
    </div>
      <span class="timestamp" id="refreshCountdown" style="margin-left:auto;padding-right:16px;color:var(--text-dim,#888);font-size:0.75rem"></span>
  </nav>
  <div class="container" id="content"><div class="loading">Loading worldview</div></div>
  <footer class="footer">Powered by Gordon ðŸ’° | Data updates every 12h | Not financial advice</footer>
  <script src="assets/charts.js"></script>
  <script>
fetch('data/dashboard.json?t='+Date.now()).then(r=>r.json()).then(data=>{
  console.log('Dashboard data:', data);
  try {
  const wv=data.worldview||{};
  const theses=wv.theses||[];
  const c=document.getElementById('content');

  if(!theses.length) {
    c.innerHTML='<div class="card"><div class="card-title">Worldview</div><p style="color:var(--text-dim)">No active theses yet.</p></div>';
    return;
  }

  c.innerHTML=theses.map(w=>{
    const conv = w.conviction || 'medium';
    const convMap = {high:0.85, medium:0.6, low:0.3};
    const convNum = typeof conv === 'number' ? conv : (convMap[conv.toLowerCase()]||0.5);
    const convColor=convNum>=0.7?'var(--green)':convNum>=0.5?'var(--gold)':'var(--red)';
    const tickers = w.tickers || [];
    return `<div class="card thesis-card" style="margin-bottom:20px">
      <div style="display:flex;justify-content:space-between;align-items:start;flex-wrap:wrap;gap:12px">
        <div>
          <h3 style="font-size:1.1rem;font-weight:700;color:var(--text);margin-bottom:4px">${w.title||'Untitled'}</h3>
          <p style="font-size:0.85rem;color:var(--text-dim);max-width:700px">${w.description||''}</p>
        </div>
        <div style="text-align:right">
          <div style="font-size:0.75rem;text-transform:uppercase;color:var(--text-dim);letter-spacing:1px">Conviction</div>
          <div style="font-size:1.4rem;font-weight:700;color:${convColor}">${typeof conv==='string' ? conv.toUpperCase() : (convNum*100).toFixed(0)+'%'}</div>
        </div>
      </div>
      <div class="progress-bar" style="margin:12px 0"><div class="progress-fill" style="width:${convNum*100}%;background:${convColor}"></div></div>
      ${tickers.length ? `<div style="margin:12px 0">${tickers.map(t=>`<span class="ticker-badge">${t}</span>`).join(' ')}</div>` : ''}
    </div>`;
  }).join('');
  } catch(e) {
    console.error('Worldview render error:', e);
    document.getElementById('content').innerHTML='<div class="loading">Error: '+e.message+'</div>';
  }
}).catch(e=>{console.error('Fetch error:',e);document.getElementById('content').innerHTML='<div class="loading">Failed to load data</div>';});
  </script>

<script>
// Auto-refresh countdown
(function(){
  var total=300, left=total;
  var el=document.getElementById('refreshCountdown');
  if(!el) return;
  setInterval(function(){
    left--;
    if(left<0) left=0;
    var m=Math.floor(left/60), s=left%60;
    el.textContent='Next refresh in '+m+'m '+s+'s';
  },1000);
})();
</script>
</body>
</html>